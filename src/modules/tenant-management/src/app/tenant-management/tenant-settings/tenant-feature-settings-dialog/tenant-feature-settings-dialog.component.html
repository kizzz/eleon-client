<p-dialog [resizable]="false" [(visible)]="showDialog" [header]="'AbpFeatureManagement::Features' | abpLocalization" [modal]="true" (visibleChange)="onDialogVisibleChange($event)">
  <div *ngIf="showDialog" class="wrapper" style="max-width: 1000px">
    <div class="flex flex-row w-full justify-content-between gap-3" *ngIf="groups.length">
      <div [style]="{'width':'15rem'}">
        <p-listbox [options]="groups" [(ngModel)]="selectedGroup" optionLabel="displayName" [style]="{'width':'15rem'}"
          [listStyle]="{'max-height': '450px'}"></p-listbox>
      </div>
      <div class="w-full" *ngIf="selectedGroup">
        <!-- <h4>{{ selectedGroup.displayName }}</h4>
        <hr class="mt-2 mb-3" /> -->

        <div class="mt-2" *ngFor="
              let feature of features[selectedGroup.name];
              let i = index;
            " [ngStyle]="feature.style" [ngSwitch]="feature.valueType?.name" (keyup.enter)="save()">
          <ng-container *ngSwitchCase="valueTypes.ToggleStringValueType">
            <div class="flex align-items-center gap-2">
              <p-checkbox [binary]="true" [(ngModel)]="feature.value" (ngModelChange)="onCheckboxClick($event, feature)"
                [inputId]="feature.name" [label]="feature.displayName">
              </p-checkbox>
              <small>{{feature.description }}</small>
            </div>
          </ng-container>
          <ng-container *ngSwitchCase="valueTypes.FreeTextStringValueType">
            <div class="grid align-items-center">
              <label class="col-3">{{ feature.displayName }}</label>
              <div class="col-9 flex flex-row align-items-center gap-2">
                <input pInputText [(ngModel)]="feature.value" (ngModelChange)="state.setDirty()" class="w-full" />
                <small>{{feature.description }}</small>
              </div>
            </div>
          </ng-container>
          <ng-container *ngSwitchDefault>{{ feature.displayName }}</ng-container>
        </div>
      </div>
      <!-- <ng-container *ngIf="false">
        <div class="md:col-4">
          <ul ngbNav #nav="ngbNav" [(activeId)]="selectedGroupDisplayName" class="nav-pills" orientation="vertical">
            <li *ngFor="let group of groups; trackBy: track.by('name')" [ngbNavItem]="group.displayName">
              <a ngbNavLink>{{ group.displayName }}</a>
              <ng-template ngbNavContent>
                <h4>{{ selectedGroupDisplayName }}</h4>
                <hr class="mt-2 mb-3" />

                <div class="mt-2" *ngFor="
                    let feature of features[group.name];
                    let i = index;
                    trackBy: track.by('id')
                  " [ngStyle]="feature.style" [ngSwitch]="feature.valueType?.name" (keyup.enter)="save()">
                  <ng-container *ngSwitchCase="valueTypes.ToggleStringValueType">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" [id]="feature.name" [(ngModel)]="feature.value"
                        (ngModelChange)="onCheckboxClick($event, feature)" />

                      <label class="form-check-label" [htmlFor]="feature.name">{{
                        feature.displayName
                        }}</label>
                      <ng-container
                        *ngTemplateOutlet="descTmp; context: { $implicit: feature.description }"></ng-container>
                    </div>
                  </ng-container>
                  <ng-container *ngSwitchCase="valueTypes.FreeTextStringValueType">
                    <div class="mb-3 form-group">
                      <label [htmlFor]="feature.name" class="form-label">{{
                        feature.displayName
                        }}</label>
                      <input class="form-control" type="text" [id]="feature.name" [(ngModel)]="feature.value"
                        [abpFeatureManagementFreeText]="feature" />

                      <ng-container
                        *ngTemplateOutlet="descTmp; context: { $implicit: feature.description }"></ng-container>
                    </div>
                  </ng-container>
                  <ng-container *ngSwitchCase="valueTypes.SelectionStringValueType">
                    <ng-container *ngIf="feature.valueType.itemSource?.items?.length">
                      <div class="mb-3 form-group">
                        <label [htmlFor]="feature.name" class="form-label">{{
                          feature.displayName
                          }}</label>
                        <select class="form-select" [id]="feature.name" [(ngModel)]="feature.value">
                          <option *ngFor="
                              let item of feature.valueType.itemSource?.items;
                              trackBy: track.by('value')
                            " [ngValue]="item.value">
                            {{
                            item.displayText?.resourceName + '::' + item.displayText?.name
                            | abpLocalization
                            }}
                          </option>
                        </select>
                        <ng-container
                          *ngTemplateOutlet="descTmp; context: { $implicit: feature.description }"></ng-container>
                      </div>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngSwitchDefault>{{ feature.displayName }}</ng-container>
                </div>
              </ng-template>
            </li>
          </ul>
        </div>

        <ng-template #descTmp let-description>
          <small *ngIf="description" class="d-block form-text text-muted">{{ description }}</small>
        </ng-template>

        <div class="md:col-8">
          <div class="py-0" [ngbNavOutlet]="nav"></div>
        </div>
      </ng-container> -->
    </div>
    <div *ngIf="!groups.length" class="text-lg">
      {{ 'AbpFeatureManagement::NoFeatureFoundMessage' | abpLocalization }}
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex align-items-center justify-content-end gap-3">
      <p-button [text]="true" [raised]="true" styleClass="p-button-secondary" icon="fa fa-times" (onClick)="cancel()" [label]="'Infrastructure::Cancel' | abpLocalization" iconPos="left" [disabled]="modalBusy"></p-button>

      <p-button [text]="true" [raised]="true" styleClass="p-button-warning" (onClick)="resetToDefault()" icon="fa fa-refresh"
        [label]="'Infrastructure::Reset' | abpLocalization" iconPos="left" [disabled]="modalBusy"></p-button>

      <p-button [text]="true" [raised]="true" styleClass="p-button-success" (onClick)="save()" icon="fa fa-check" [label]="'Infrastructure::Save' | abpLocalization"
        iconPos="left" [loading]="loading" [disabled]="modalBusy"></p-button>
    </div>
  </ng-template>
</p-dialog>