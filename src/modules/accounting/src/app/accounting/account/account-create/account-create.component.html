<app-page-title [title]="title" icon="fas fa-user-alt"> 
  <ng-template #afterTitleContent>
      <app-account-status-tag class="ml-2" [value]="header.data.accountStatus" style="position: relative; top: -4px;"></app-account-status-tag>
    </ng-template>
</app-page-title>
<div class="content" *ngIf="header?.data?.id">
  <div #generalDetailsCard class="grid">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">
            {{ 'AccountingModule::Acount:HeaderTitle' | abpLocalization }}
          </h5>
          <div class="grid m-0">
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label appRequired>{{
                'AccountingModule::Account:Header:AccountName' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.name"
                (change)="resetValidators()"
                [disabled]="loading"
                type="text"
                pInputText
                [ngClass]="{ 'ng-invalid ng-dirty': header.accountValidators.nameEmpty }"
                [style]="{ width: '100%' }"
                maxlength="230"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label appRequired>{{
                'AccountingModule::Account:Header:ContactPersonEmail' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.contactPersonEmail"
                [disabled]="loading"
                (change)="resetValidators()"
                type="text"
                pInputText
                [ngClass]="{ 'ng-invalid ng-dirty': header.accountValidators.contactEmailEmpty || header.accountValidators.contactEmailInvalid }"
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:Active' | abpLocalization
              }}</label>
              <p-select
                [options]="activeOptions"
                [(ngModel)]="header.data.active"
                optionValue="value"
                optionLabel="label"
                [filter]="false"
                autoWidth="false"
                [style]="{ width: '100%' }"
                [disabled]="loading"
              >
              </p-select>
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label>{{
                'AccountingModule::Account:Header:Owner' | abpLocalization
              }}</label>
              <div class="p-inputgroup">
                <input
                  class="no-select"
                  inputId="owner-input"
                  [value]="header.owner?.name || ''"
                  type="text"
                  pInputText
                  [disabled]="true"
                  placeholder="{{
                    'AccountingModule::Account:Header:Owner:Placeholder'
                      | abpLocalization
                  }}"
                />
                <button
                  type="button"
                  (click)="openOwnerSelectionDialog()"
                  pButton
                  pRipple
                  icon="fa fa-user"
                  [disabled]="loading"
                  styleClass="p-button-info"
                  class="p-button-text"
                  [pTooltip]="'AccountingModule::Account:Header:Owner:Select' | abpLocalization"
                ></button>
              </div>
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:CompanyCID' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.companyCID"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:PaymentMethod' | abpLocalization
              }}</label>
              <p-select
                [options]="localizedPaymentMethods"
                [(ngModel)]="header.data.paymentMethod"
                optionValue="method"
                optionLabel="name"
                [filter]="false"
                autoWidth="false"
                [style]="{ width: '100%' }"
                [disabled]="loading"
              >
              </p-select>
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:BillingName' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.billingName"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:ContactPersonTelephone' | abpLocalization
              }}</label>
              
              <p-inputMask mask="(999) 999-9999" 
                [(ngModel)]="header.data.contactPersonTelephone"
                [disabled]="loading"
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:BillingAddressLine1' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.billingAddressLine1"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label>{{
                'AccountingModule::Account:Header:BillingAddressLine2' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.billingAddressLine2"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:Country' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.country"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:City' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.city"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:StateOrProvince' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.stateOrProvince"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-4'
              "
            >
              <label >{{
                'AccountingModule::Account:Header:PostalCode' | abpLocalization
              }}</label>
              <input
                [(ngModel)]="header.data.postalCode"
                [disabled]="loading"
                type="text"
                pInputText
                [style]="{ width: '100%' }"
              />
            </div>
            <div
              class="field pr-only"
              [ngClass]="
                generalDetailsCard.offsetWidth < viewportBreakpoints.md
                  ? 'col-12'
                  : 'sm:col-12'
              "
            >
              <label>{{
                'AccountingModule::Account:Header:Description' | abpLocalization
              }}</label>
              <textarea
                [(ngModel)]="header.data.description"
                [disabled]="loading"
                pInputTextarea
                [rows]="3"
                [style]="{ width: '100%' }"
              ></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div #rowsCard class="card table-card">
    <div class="card-body">
      <p-tabs [value]="activeTabIndex" [scrollable]="false" (valueChange)="activeTabIndex = $event">
        <p-tablist>
          <p-tab [value]="0">
            <span
            >
              {{ 'AccountingModule::Subscriptions' | abpLocalization }}
            </span>
          </p-tab>
          <p-tab [value]="1">
            <span
            >
              {{ 'AccountingModule::UserMembers' | abpLocalization }}
            </span>
          </p-tab>
          <p-tab [value]="2">
            <span
            >
              {{ 'AccountingModule::TenantMembers' | abpLocalization }}
            </span>
          </p-tab>
        </p-tablist>
        <p-tabpanels>
          <p-tabpanel [value]="0">
            <app-account-packages-management
              #packagesComponent
              [accountId]="header.data.id"
              [isAccountManager]="isAccountManager"
              [localizedBillingPeriodTypes]="localizedBillingPeriodTypes"
              (dirtyChange)="pageStateService.setDirty()"
            ></app-account-packages-management>
          </p-tabpanel>
          <p-tabpanel [value]="1">
            <app-account-user-management
              #userMembersComponent
              [accountId]="header.data.id"
              [loading]="loading"
              (dirtyChange)="pageStateService.setDirty()"
            ></app-account-user-management>
          </p-tabpanel>
          <p-tabpanel [value]="2">
            <app-account-tenant-management
              #tenantMembersComponent
              [accountId]="header.data.id"
              [loading]="loading"
              (dirtyChange)="pageStateService.setDirty()"
            ></app-account-tenant-management>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>
  </div>
</div>