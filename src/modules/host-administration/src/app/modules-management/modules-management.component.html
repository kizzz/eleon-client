<!-- <app-page-title [title]="'TenantManagement::Modules' | abpLocalization" icon="fa-solid fa-puzzle-piece">
</app-page-title> -->

<p-table #dt1 [loading]="loading" [value]="modules" [paginator]="false" style="min-height: 200px;"
    dataKey="id">
    <ng-template pTemplate="header">
        <tr>
          <th class="text-center">{{'TenantManagement::Name' | abpLocalization}}</th>
          <th class="text-center" appResponsiveColumn="500"> {{ 'TenantManagement::Path' | abpLocalization}}</th>
          <th class="text-center" appResponsiveColumn="500">{{ 'TenantManagement::Source' | abpLocalization}}</th>
          <th class="text-center" appResponsiveColumn="100">{{ 'TenantManagement::LoadLevel' | abpLocalization}}</th>
          <th appResponsiveColumn="100"></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-module>
        <tr>
            <td>
              <div class="flex align-items-center gap-2">
                <span>
                  <i class="fa-solid fa-puzzle-piece"></i>
                </span>
                <span>
                  {{ module.displayName }}
                </span>
              </div>
            </td>
            <td>
                <app-ellipsis [text]="module.path"></app-ellipsis>
            </td>
            <td> 
              {{ module.source }}
            </td>
            <td>
              {{ formatLoadLevel(module.loadLevel) }}
            </td>
            <td>
                <div class="flex gap-1 justify-content-end align-items-center" *ngIf="!module.isSystem">
                    <p-button type="button" icon="fa fa-gear" (click)="editSettings(module)" [text]="true"
                        [pTooltip]="'TenantManagement::Settings' | abpLocalization" tooltipPosition="top">
                    </p-button>
                    <p-button type="button"
                      icon="fa fa-trash" (click)="delete(module)" [text]="true" severity="danger"
                      [pTooltip]="'Infrastructure::Delete' | abpLocalization" tooltipPosition="top">
                    </p-button>
                </div>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr class="table-emptymessage">
        <td class="w-full" colspan="5">
          <div class="card w-full">
            <div class="card-body w-full text-center">
              {{ 'TenantManagement::Modules:List:Empty' | abpLocalization }}
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
</p-table>


<p-dialog [resizable]="false" [header]="'TenantManagement::AddClientModule' | abpLocalization" [(visible)]="displayDiscoverDialog" modal="modal"
(visibleChange)="clear()"
  *ngIf="displayDiscoverDialog">
  <div class="dialog-standard">

    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0" appRequired>{{ 'TenantManagement::DisplayName' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <input class="w-full" pInputText [(ngModel)]="newModule.displayName" [ngClass]="{'ng-invalid ng-dirty': nameEmpty}" (input)="resetValidators()" />
      </div>
    </div>
    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0" appRequired>{{ 'TenantManagement::Path' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <div class="p-inputgroup" [ngClass]="{'ng-invalid ng-dirty invalid': pathEmpty }">
          <span class="p-inputgroup-addon small" [pTooltip]="tooltip" tooltipPosition="top">/modules/</span>
          <input class="w-full" id="name" type="text" pInputText [(ngModel)]="newModule.path" 
            (input)="resetValidators()"/>
        </div>
      </div>
    </div>
    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0">{{ 'TenantManagement::Source' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <input pInputText [(ngModel)]="newModule.source" class="w-full" />
      </div>
    </div>

    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0">{{ 'TenantManagement::LoadLevel' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <p-select id="loadLevel" class="w-full" [options]="loadLevels" [(ngModel)]="newModule.loadLevel" optionLabel="label" optionValue="value"
            appendTo="body" [style]="{'width':'100%'}">
        </p-select>
      </div>
    </div>

  </div>
  <ng-template #footer>
    <p-button icon="pi pi-times"  [label]="'Infrastructure::Cancel' | abpLocalization" (click)="displayDiscoverDialog = false" [text]="true" [raised]="true" styleClass="p-button-secondary"></p-button>
    <p-button icon="fa fa-plus" [label]="'Infrastructure::Add' | abpLocalization" (click)="create()" [text]="true" [raised]="true" [disabled]="loading"></p-button>
  </ng-template>
</p-dialog>


<p-dialog [resizable]="false" [header]="'TenantManagement::ClientModuleSettings' | abpLocalization" [(visible)]="displaySettingsDialog" modal="modal"
(visibleChange)="clear()"
  *ngIf="displaySettingsDialog && selectedModule">
  <div class="dialog-standard">
    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0" appRequired>{{ 'TenantManagement::DisplayName' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <input class="w-full" pInputText [(ngModel)]="selectedModule.displayName" [ngClass]="{'ng-invalid ng-dirty': nameEmpty}" (input)="resetValidators()"/>
      </div>
    </div>
    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0" appRequired>{{ 'TenantManagement::Path' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <div class="p-inputgroup">
          <span class="p-inputgroup-addon small" [pTooltip]="tooltip" tooltipPosition="top">/modules/</span>
          <input class="w-full" id="name" type="text" pInputText [(ngModel)]="selectedModule.path" 
            [ngClass]="{'ng-invalid ng-dirty': pathEmpty}" (input)="resetValidators()"/>
        </div>
      </div>
    </div>
    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0">{{ 'TenantManagement::Source' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <input class="w-full" pInputText [(ngModel)]="selectedModule.source" />
      </div>
    </div>

    <div class="field grid">
      <label class="col-12 mb-2 md:col-4 md:mb-0">{{ 'TenantManagement::LoadLevel' | abpLocalization}}</label>
      <div class="col-12 md:col-8">
        <p-select id="loadLevel" [options]="loadLevels" 
          [(ngModel)]="selectedModule.loadLevel" class="w-full"
          appendTo="body" autoWidth="false" [style]="{'width':'100%'}">
      </p-select>
      </div>
    </div>
  </div>
  <ng-template #footer>
    <p-button icon="pi pi-times"  [label]="'Infrastructure::Cancel' | abpLocalization" (click)="displaySettingsDialog = false" [text]="true" [raised]="true" styleClass="p-button-secondary"></p-button>
    <p-button icon="fa fa-check" [label]="'Infrastructure::Save' | abpLocalization" (click)="edit()" [text]="true" [raised]="true" [disabled]="loading"></p-button>
  </ng-template>
</p-dialog>

